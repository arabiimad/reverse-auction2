{# templates/dashboard/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Tableau de bord{% endblock %}

{% block body %}
  <div class="max-w-4xl mx-auto mt-8 space-y-8">

    {# --- Solde --- #}
    <div class="p-4 bg-yellow-100 rounded">
      <strong>ðŸ’° Solde actuel :</strong> {{ wallet.balance }} jetons
    </div>

    {# --- Achats de jetons --- #}
    <div class="p-6 bg-white rounded shadow">
      <h2 class="text-lg font-semibold mb-2">ðŸ“¦ Achats de jetons</h2>
      {% if purchases is empty %}
        <p>Aucun achat trouvÃ©</p>
      {% else %}
        <ul class="list-disc list-inside">
          {% for purchase in purchases %}
            <li>
              {{ purchase.tokenPack.label }} â€“
              <small>{{ purchase.createdAt|date('d/m/Y H:i') }}</small>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
      {# Lien corrigÃ© vers la route dâ€™Ã©tape 1 #}
      <a href="{{ path('purchase_choose') }}" class="text-blue-600 hover:underline mt-2 inline-block">
        ðŸ›’ Acheter des jetons
      </a>
    </div>

    {# --- EnchÃ¨res en cours --- #}
    <div class="p-6 bg-white rounded shadow">
      <h2 class="text-lg font-semibold mb-2">ðŸ”¨ EnchÃ¨res en cours</h2>
      {% if openAuctions is empty %}
        <p>Aucune enchÃ¨re ouverte</p>
      {% else %}
        <ul class="list-disc list-inside">
          {% for auction in openAuctions %}
            <li>
              {{ auction.product.name }}
              (clÃ´ture {{ auction.endAt|date('d/m H:i') }}) â€“
              <a href="{{ path('bids_show', { id: auction.id }) }}" class="text-blue-600 hover:underline">
                Voir / Miser
              </a>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    {# --- Historique des transactions --- #}
    <div class="p-6 bg-white rounded shadow">
      <h2 class="text-lg font-semibold mb-2">ðŸ“œ Historique des transactions</h2>
      {% if transactions is empty %}
        <p>Aucune transaction enregistrÃ©e.</p>
      {% else %}
        <table class="w-full text-left">
          <thead>
            <tr>
              <th>Date</th><th>Type</th><th>Montant</th>
            </tr>
          </thead>
          <tbody>
            {% for tx in transactions %}
              <tr>
                <td>{{ tx.createdAt|date('d/m/Y H:i') }}</td>
                <td>{{ tx.type }}</td>
                <td class="{{ tx.amount > 0 ? 'text-green-600' : 'text-red-600' }}">
                  {{ tx.amount > 0 ? '+' : '' }}{{ tx.amount }} jetons
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
      <a href="{{ path('bids_user') }}" class="text-purple-600 hover:underline mt-2 inline-block">
        ðŸ“Œ Voir mes mises
      </a>
    </div>

  </div>
{% endblock %}
